#!/bin/bash

function moveGeneratedTests {
    mkdir -p generated_tests/$1
    mv RegressionTest.java generated_tests/$1/RegressionTest.java
    mv RegressionTest0.java generated_tests/$1/RegressionTest0.java
}

project_root=$(pwd)
dir="$project_root/pruebas/subjects/$2"
randoop_jar="libs/randoop-all-4.3.1.jar"

if [ ! -d "$dir/build" ]; then  #compile if not done yet
    cd $dir
    ./gradlew -q -Dskip.tests jar
    cd ../../
fi
    
project_classpath="$dir/build/libs/*:$dir/libs/*"
full_class_package=$1.$3

echo "${1}.${3}" > classlist.txt   #write main class in classlist file

jdeps -apionly -v -cp $project_classpath $full_class_package | grep -v '^[A-Za-z]' | sed -E 's/^.* -> ([^ ]+) .*$/\1/' | sort | uniq >> classlist.txt

# queda hacer un file con los parametros para el script, correr randoop para cada subject y mover los tests a un folder
echo $project_classpath
java -classpath ${randoop_jar}:$project_classpath randoop.main.Main gentests --classlist=classlist.txt --time-limit=10

moveGeneratedTests $2
